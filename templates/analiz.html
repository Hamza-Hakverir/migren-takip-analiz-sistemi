<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DetaylÄ± Analiz Raporu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { background-color: #121212; color: #e0e0e0; font-family: 'Segoe UI', sans-serif; margin: 0; }
        .navbar { background-color: #1e1e1e; padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; position: sticky; top:0; z-index:100; }
        .nav-brand { font-size: 1.5em; font-weight: bold; color: #bb86fc; }
        .btn-back { color: #ccc; text-decoration: none; border: 1px solid #555; padding: 5px 15px; border-radius: 20px; transition:0.3s; }
        .btn-back:hover { background: #333; color: white; }

        .container { max-width: 1200px; margin: 30px auto; padding: 20px; }

        /* GÃœVENÄ°LÄ°RLÄ°K */
        .trust-box { background: #1f2a48; padding: 20px; border-radius: 15px; margin-bottom: 30px; border: 1px solid #333; }
        .progress-bg { width: 100%; height: 10px; background: #333; border-radius: 5px; margin-top: 10px; overflow: hidden; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #ff7675, #ffeaa7, #55efc4); width: 0%; transition: width 1s; }

        /* KPI KARTLARI */
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background: #1e1e1e; padding: 20px; border-radius: 15px; text-align: center; border: 1px solid #333; }
        .kpi-val { font-size: 2.5em; font-weight: bold; margin: 10px 0; color: white; }
        .kpi-label { color: #aaa; font-size: 0.9em; text-transform: uppercase; letter-spacing: 1px; }

        /* Ã–NERÄ° KARTI */
        .suggestion-box { 
            background: linear-gradient(135deg, #2d3436, #00b894); color: white;
            padding: 20px; border-radius: 15px; margin-bottom: 30px; text-align: center;
            font-size: 1.1em; font-style: italic; box-shadow: 0 5px 15px rgba(0, 184, 148, 0.2);
        }

        /* GRAFÄ°K GRID */
        .chart-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; }
        .chart-card { background: #1e1e1e; padding: 25px; border-radius: 15px; border: 1px solid #333; height: 400px; display:flex; flex-direction:column; justify-content:center; }
        .chart-title { color: #bb86fc; margin-bottom: 15px; font-weight: bold; text-align: center; border-bottom: 1px solid #333; padding-bottom: 10px; }

        .empty-state { text-align: center; margin-top: 100px; color: #666; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-brand"><i class="fas fa-chart-pie"></i> Analiz Merkezi</div>
        <a href="{{ url_for('panel') }}" class="btn-back">â† Panele DÃ¶n</a>
    </nav>

    <div class="container">
        
        {% if veri_yok %}
            <div class="empty-state">
                <i class="fas fa-folder-open" style="font-size:5em; margin-bottom:20px;"></i>
                <h2>HenÃ¼z Yeterli Veri Yok</h2>
                <p>Analiz yapabilmek iÃ§in lÃ¼tfen atak kaydÄ± girmeye baÅŸla.</p>
            </div>
        {% else %}

            <div class="trust-box">
                <div style="display:flex; justify-content:space-between;">
                    <span>Analiz GÃ¼venilirliÄŸi: %{{ guven_orani }}</span>
                    <span>Hedef Veri: 20 Atak</span>
                </div>
                <div class="progress-bg"><div class="progress-bar" style="width: {{ guven_orani }}%;"></div></div>
            </div>

            <div class="kpi-grid">
                <div class="kpi-card"><div class="kpi-label">Toplam Atak</div><div class="kpi-val">{{ toplam_atak }}</div></div>
                <div class="kpi-card"><div class="kpi-label">Ort. Åiddet</div><div class="kpi-val">{{ ortalama_siddet }}</div></div>
                <div class="kpi-card"><div class="kpi-label">Ort. SÃ¼re (Dk)</div><div class="kpi-val">{{ ortalama_sure }}</div></div>
                <div class="kpi-card"><div class="kpi-label">BaÅŸ DÃ¼ÅŸman</div><div class="kpi-val" style="font-size:1.3em; color:#ff7675; margin-top:20px;">{{ bas_dusman }}</div></div>
            </div>

            <div class="chart-grid">
                
                <div class="chart-card">
                    <div class="chart-title">ğŸ”¥ 1. TÃ¼m Tetikleyiciler</div>
                    <div style="flex-grow:1; position:relative;"><canvas id="chartTetik"></canvas></div>
                </div>

                <div class="chart-card">
                    <div class="chart-title">ğŸ§  2. AÄŸrÄ± HaritasÄ±</div>
                    <div style="flex-grow:1; position:relative;"><canvas id="chartKonum"></canvas></div>
                </div>

                <div class="chart-card">
                    <div class="chart-title">âš¡ 3. AÄŸrÄ± Karakteri (Tipi)</div>
                    <div style="flex-grow:1; position:relative;"><canvas id="chartAgriTipi"></canvas></div>
                </div>

                <div class="chart-card">
                    <div class="chart-title">ğŸ” 4. Tetikleyici Besinler</div>
                    <div style="flex-grow:1; position:relative;"><canvas id="chartBesin"></canvas></div>
                </div>

                <div class="chart-card">
                    <div class="chart-title">ğŸ’Š 5. KullanÄ±lan Ä°laÃ§lar</div>
                    <div style="flex-grow:1; position:relative;"><canvas id="chartIlac"></canvas></div>
                </div>

                <div class="chart-card">
                    <div class="chart-title">â° 6. Saat DaÄŸÄ±lÄ±mÄ±</div>
                    <div style="flex-grow:1; position:relative;"><canvas id="chartSaat"></canvas></div>
                </div>

                <div class="chart-card" style="grid-column: 1 / -1;">
                    <div class="chart-title">ğŸ§˜ 7. Rahatlama YÃ¶ntemleri ve Etkileri</div>
                    <div style="height: 300px; position:relative;"><canvas id="chartRahat"></canvas></div>
                    
                    <div class="suggestion-box" style="margin-top: 20px; margin-bottom: 0;">
                        <i class="fas fa-robot"></i> Yapay Zeka Ã–nerisi: {{ oneri }}
                    </div>
                </div>

            </div>

        {% endif %}

    </div>

    {% if not veri_yok %}
    <script>
        const colors = ['#6c5ce7', '#00b894', '#fdcb6e', '#e17055', '#74b9ff', '#a29bfe'];

        // 1. TETÄ°KLEYÄ°CÄ°LER (Doughnut)
        new Chart(document.getElementById('chartTetik'), {
            type: 'doughnut',
            data: { labels: {{ lbl_tetik | safe }}, datasets: [{ data: {{ val_tetik | safe }}, backgroundColor: colors, borderWidth:0 }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { color: '#ccc' } } } }
        });

        // 2. AÄRI HARÄ°TASI (Radar)
        new Chart(document.getElementById('chartKonum'), {
            type: 'radar',
            data: { labels: {{ lbl_konum | safe }}, datasets: [{ label: 'BÃ¶lgesel YoÄŸunluk', data: {{ val_konum | safe }}, backgroundColor: 'rgba(255, 118, 117, 0.4)', borderColor: '#ff7675', pointBackgroundColor: '#fff' }] },
            options: { responsive: true, maintainAspectRatio: false, scales: { r: { grid: { color: '#444' }, ticks: { display: false, backdropColor: 'transparent' }, pointLabels: { color: '#ccc', font: {size: 14} } } }, plugins: { legend: { display: false } } }
        });

        // 3. AÄRI TÄ°PÄ° (Polar Area - YENÄ°)
        new Chart(document.getElementById('chartAgriTipi'), {
            type: 'polarArea',
            data: { labels: {{ lbl_agri_tipi | safe }}, datasets: [{ label: 'GÃ¶rÃ¼lme SÄ±klÄ±ÄŸÄ±', data: {{ val_agri_tipi | safe }}, backgroundColor: ['#ff7675', '#0984e3', '#fdcb6e', '#00b894', '#6c5ce7', '#e17055'], borderWidth: 1 }] },
            options: { responsive: true, maintainAspectRatio: false, scales: { r: { grid: { color: '#333' }, ticks: { display: false, backdropColor: 'transparent' } } }, plugins: { legend: { position: 'right', labels: { color: '#ccc' } } } }
        });

        // 4. BESÄ°NLER (Pie)
        new Chart(document.getElementById('chartBesin'), {
            type: 'pie',
            data: { labels: {{ lbl_besin | safe }}, datasets: [{ data: {{ val_besin | safe }}, backgroundColor: ['#ff7675', '#fab1a0', '#ffeaa7', '#55efc4', '#74b9ff'], borderWidth:0 }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { color: '#ccc' } } } }
        });

        // 5. Ä°LAÃ‡LAR (Yatay Bar)
        new Chart(document.getElementById('chartIlac'), {
            type: 'bar',
            data: { labels: {{ lbl_ilac | safe }}, datasets: [{ label: 'KullanÄ±m SayÄ±sÄ±', data: {{ val_ilac | safe }}, backgroundColor: '#a29bfe', borderRadius:5 }] },
            options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, scales: { x: { grid: { color: '#333' }, ticks: { color: '#aaa' } }, y: { grid: { display: false }, ticks: { color: '#fff' } } }, plugins: { legend: { display: false } } }
        });

        // 6. SAAT (Dikey Bar)
        new Chart(document.getElementById('chartSaat'), {
            type: 'bar',
            data: { labels: {{ lbl_saat | safe }}, datasets: [{ label: 'Atak SÄ±klÄ±ÄŸÄ±', data: {{ val_saat | safe }}, backgroundColor: '#74b9ff', borderRadius:5 }] },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { grid: { color: '#333' }, ticks: { color: '#aaa' } }, x: { grid: { display: false }, ticks: { color: '#fff' } } }, plugins: { legend: { display: false } } }
        });

        // 7. RAHATLAMA (Dikey Bar - YeÅŸil)
        new Chart(document.getElementById('chartRahat'), {
            type: 'bar',
            data: { labels: {{ lbl_rahat | safe }}, datasets: [{ label: 'Tercih Edilme', data: {{ val_rahat | safe }}, backgroundColor: '#00b894', borderRadius:5 }] },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { grid: { color: '#333' }, ticks: { color: '#aaa' } }, x: { grid: { display: false }, ticks: { color: '#fff' } } }, plugins: { legend: { display: false } } }
        });
    </script>
    {% endif %}

</body>
</html>